"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractRequestData = extractRequestData;
exports.extractRequestMetadata = extractRequestMetadata;
const validateRequest_1 = require("./validateRequest");
function extractRequestData(parsed) {
    return {
        threadID: parsed.threadID || Date.now().toString(),
        prompt: parsed.prompt,
        provider: parsed.provider || undefined,
        model: parsed.model,
        userId: parsed.userId || undefined,
    };
}
function extractRequestMetadata(event, parsed) {
    if (!(0, validateRequest_1.requestIsValid)(event)) {
        console.error('Invalid request');
        return {};
    }
    try {
        return {
            userType: event.headers?.['x-user-type'] || parsed.userType,
            region: event.headers?.['x-region'] || parsed.region,
        };
    }
    catch (error) {
        console.error('Error extracting request metadata:', error);
        return {};
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0cmFjdFJlcXVlc3REYXRhLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGFtYmRhL3V0aWwvZXh0cmFjdFJlcXVlc3REYXRhLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBSUEsZ0RBUUM7QUFFRCx3REFlQztBQTNCRCx1REFBbUQ7QUFFbkQsU0FBZ0Isa0JBQWtCLENBQUMsTUFBc0I7SUFDdkQsT0FBTztRQUNMLFFBQVEsRUFBRSxNQUFNLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxRQUFRLEVBQUU7UUFDbEQsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNO1FBQ3JCLFFBQVEsRUFBRSxNQUFNLENBQUMsUUFBUSxJQUFJLFNBQVM7UUFDdEMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLO1FBQ25CLE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTSxJQUFJLFNBQVM7S0FDbkMsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFnQixzQkFBc0IsQ0FBQyxLQUFjLEVBQUUsTUFBc0I7SUFDekUsSUFBSSxDQUFDLElBQUEsZ0NBQWMsRUFBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQzNCLE9BQU8sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUNqQyxPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFFRCxJQUFJLENBQUM7UUFDSCxPQUFPO1lBQ0wsUUFBUSxFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxhQUFhLENBQUMsSUFBSSxNQUFNLENBQUMsUUFBUTtZQUMzRCxNQUFNLEVBQUUsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxNQUFNO1NBQ3JELENBQUM7SUFDSixDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNqQixPQUFPLENBQUMsS0FBSyxDQUFDLG9DQUFvQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXF1ZXN0UGF5bG9hZCB9IGZyb20gJy4vc2NoZW1hcy9yZXF1ZXN0U2NoZW1hJztcbmltcG9ydCB7IFBhcnNlZFJlcXVlc3REYXRhLCBSZXF1ZXN0TWV0YWRhdGEgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IHJlcXVlc3RJc1ZhbGlkIH0gZnJvbSAnLi92YWxpZGF0ZVJlcXVlc3QnO1xuXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdFJlcXVlc3REYXRhKHBhcnNlZDogUmVxdWVzdFBheWxvYWQpOiBQYXJzZWRSZXF1ZXN0RGF0YSB7XG4gIHJldHVybiB7XG4gICAgdGhyZWFkSUQ6IHBhcnNlZC50aHJlYWRJRCB8fCBEYXRlLm5vdygpLnRvU3RyaW5nKCksXG4gICAgcHJvbXB0OiBwYXJzZWQucHJvbXB0LFxuICAgIHByb3ZpZGVyOiBwYXJzZWQucHJvdmlkZXIgfHwgdW5kZWZpbmVkLFxuICAgIG1vZGVsOiBwYXJzZWQubW9kZWwsXG4gICAgdXNlcklkOiBwYXJzZWQudXNlcklkIHx8IHVuZGVmaW5lZCxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RSZXF1ZXN0TWV0YWRhdGEoZXZlbnQ6IHVua25vd24sIHBhcnNlZDogUmVxdWVzdFBheWxvYWQpOiBSZXF1ZXN0TWV0YWRhdGEge1xuICAgIGlmICghcmVxdWVzdElzVmFsaWQoZXZlbnQpKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIHJlcXVlc3QnKTtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlclR5cGU6IGV2ZW50LmhlYWRlcnM/LlsneC11c2VyLXR5cGUnXSB8fCBwYXJzZWQudXNlclR5cGUsXG4gICAgICAgIHJlZ2lvbjogZXZlbnQuaGVhZGVycz8uWyd4LXJlZ2lvbiddIHx8IHBhcnNlZC5yZWdpb24sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZXh0cmFjdGluZyByZXF1ZXN0IG1ldGFkYXRhOicsIGVycm9yKTtcbiAgICByZXR1cm4ge307XG4gIH1cbn1cblxuXG4iXX0=