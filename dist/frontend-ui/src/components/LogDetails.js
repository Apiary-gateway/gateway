"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const react_1 = require("react");
const CollapsibleField = ({ label, value, }) => {
    const [isExpanded, setIsExpanded] = (0, react_1.useState)(false);
    const lines = value.split('\n');
    const showMore = lines.length > 2;
    return (<div className="log-detail-row">
      <div className="log-detail-label">{label}</div>
      <div className="log-detail-value">
        <div className="collapsible-content">
          {isExpanded ? (lines.map((line, i) => <div key={i}>{line}</div>)) : (<>
              {lines.slice(0, 2).map((line, i) => (<div key={i}>{line}</div>))}
              {showMore && <div>...</div>}
            </>)}
        </div>
        {showMore && (<button className="collapsible-toggle-button" onClick={() => setIsExpanded(!isExpanded)}>
            {isExpanded ? '▼' : '▶'} {isExpanded ? 'Show Less' : 'Show More'}
          </button>)}
      </div>
    </div>);
};
const JsonField = ({ value }) => {
    const [isExpanded, setIsExpanded] = (0, react_1.useState)(false);
    let parsedValue;
    try {
        // First parse to handle any escape characters
        const unescapedValue = JSON.parse(value);
        // Then stringify and parse again to get clean JSON
        parsedValue = JSON.parse(JSON.stringify(unescapedValue, null, 2));
    }
    catch {
        return <div className="log-detail-value">{value}</div>;
    }
    return (<div className="json-field">
      <button className="json-toggle-button" onClick={() => setIsExpanded(!isExpanded)}>
        {isExpanded ? '▼' : '▶'} {'{ ... }'}
      </button>
      {isExpanded && (<pre className="json-content">
          {JSON.stringify(parsedValue, null, 2)}
        </pre>)}
    </div>);
};
const ModelRoutingHistory = ({ history }) => {
    if (!history)
        return null;
    try {
        let events;
        if (Array.isArray(history)) {
            events = history;
        }
        else if (typeof history === 'string') {
            try {
                events = JSON.parse(history);
            }
            catch {
                // If it's a string but not JSON, try to parse it as a comma-separated list
                events = history.split('→').map((item) => {
                    const [provider, model] = item.trim().split(':');
                    return {
                        type: 'routed_to_specified',
                        provider: provider?.trim(),
                        model: model?.trim(),
                    };
                });
            }
        }
        else {
            events = [history];
        }
        if (!Array.isArray(events)) {
            events = [events];
        }
        // Filter out any invalid events
        events = events
            .map((e) => JSON.parse(e))
            .filter((event) => event && (event.type || event.provider));
        if (events.length === 0)
            return null;
        return (<div className="log-detail-row">
        <div className="log-detail-label">Model Routing History</div>
        <div className="log-detail-value">
          <div className="routing-history">
            {events.map((event, index) => (<div key={index} className="routing-event">
                <span className="event-type">{event.type || 'routed'}</span>
                {event.provider && (<span className="event-detail">
                    {event.provider}:{event.model || 'default'}
                  </span>)}
                {index < events.length - 1 && (<span className="event-arrow">→</span>)}
              </div>))}
          </div>
        </div>
      </div>);
    }
    catch (error) {
        console.error('Error parsing model routing history:', error, history);
        return null;
    }
};
const LogDetail = ({ log }) => {
    const getPrompt = () => {
        try {
            const request = JSON.parse(log.raw_request || '{}');
            const body = JSON.parse(request.body || '{}');
            return body.prompt;
        }
        catch {
            return null;
        }
    };
    const getResponse = () => {
        try {
            const response = JSON.parse(log.raw_response || '{}');
            return response.text;
        }
        catch {
            return null;
        }
    };
    const formatValue = (key, value) => {
        if (value === null || value === undefined || value === '')
            return null;
        if (key === 'timestamp' && typeof value === 'string') {
            return new Date(value).toLocaleString(undefined, {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false,
                timeZoneName: 'short',
            });
        }
        if (key === 'raw_request' || key === 'raw_response' || key === 'metadata') {
            return <JsonField value={value}/>;
        }
        if (key === 'is_successful') {
            return value ? 'success' : 'failure';
        }
        return String(value);
    };
    const logFields = [
        { key: 'timestamp', label: 'Timestamp' },
        { key: 'latency', label: 'Latency (ms)' },
        { key: 'is_successful', label: 'Status' },
        { key: 'success_reason', label: 'Success Reason' },
        { key: 'error_reason', label: 'Error Reason' },
        { key: 'user_id', label: 'User ID' },
        { key: 'thread_id', label: 'Thread ID' },
        { key: 'provider', label: 'Provider' },
        { key: 'model', label: 'Model' },
        { key: 'cost', label: 'Cost' },
        { key: 'metadata', label: 'Metadata' },
        { key: 'raw_request', label: 'Raw Request' },
        { key: 'raw_response', label: 'Raw Response' },
        { key: 'error_message', label: 'Error Message' },
    ];
    const prompt = getPrompt();
    const response = getResponse();
    return (<div className="log-detail-container">
      <h2>Log Details</h2>
      <div className="log-detail-content">
        <div className="log-detail-row">
          <div className="log-detail-label">ID</div>
          <div className="log-detail-value">{log.id || 'N/A'}</div>
        </div>

        {prompt && <CollapsibleField label="Prompt" value={prompt}/>}
        {response && <CollapsibleField label="Response" value={response}/>}
        {log.model_routing_history && (<ModelRoutingHistory history={log.model_routing_history}/>)}

        {logFields.map(({ key, label }) => {
            const value = formatValue(key, log[key]);
            if (value === null)
                return null;
            return (<div key={key} className="log-detail-row">
              <div className="log-detail-label">{label}</div>
              <div className="log-detail-value">{value}</div>
            </div>);
        })}
      </div>
    </div>);
};
exports.default = LogDetail;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTG9nRGV0YWlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2Zyb250ZW5kLXVpL3NyYy9jb21wb25lbnRzL0xvZ0RldGFpbHMudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsaUNBQWlDO0FBTWpDLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxFQUN4QixLQUFLLEVBQ0wsS0FBSyxHQUlOLEVBQUUsRUFBRTtJQUNILE1BQU0sQ0FBQyxVQUFVLEVBQUUsYUFBYSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3BELE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEMsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFFbEMsT0FBTyxDQUNMLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FDN0I7TUFBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLENBQzlDO01BQUEsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUMvQjtRQUFBLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxxQkFBcUIsQ0FDbEM7VUFBQSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FDWixLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUNsRCxDQUFDLENBQUMsQ0FBQyxDQUNGLEVBQ0U7Y0FBQSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLEVB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QyxxQkFBcUIsSUFBSSxDQUM1QixDQUFDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxFQUFHLENBQzVELENBRUQ7O1FBQUEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRTtZQUNoQyxNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFxQixDQUFDLENBQUMsQ0FBQztZQUMzRCxJQUFJLEtBQUssS0FBSyxJQUFJO2dCQUFFLE9BQU8sSUFBSSxDQUFDO1lBRWhDLE9BQU8sQ0FDTCxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQ3ZDO2NBQUEsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsR0FBRyxDQUM5QztjQUFBLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUcsQ0FDaEQ7WUFBQSxFQUFFLEdBQUcsQ0FBQyxDQUNQLENBQUM7UUFDSixDQUFDLENBQUMsQ0FDSjtNQUFBLEVBQUUsR0FBRyxDQUNQO0lBQUEsRUFBRSxHQUFHLENBQUMsQ0FDUCxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsa0JBQWUsU0FBUyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9nRW50cnkgfSBmcm9tICcuLi90eXBlcy9sb2dzLnR5cGVzJztcbmltcG9ydCB7IHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuXG5pbnRlcmZhY2UgTG9nRGV0YWlsUHJvcHMge1xuICBsb2c6IExvZ0VudHJ5O1xufVxuXG5jb25zdCBDb2xsYXBzaWJsZUZpZWxkID0gKHtcbiAgbGFiZWwsXG4gIHZhbHVlLFxufToge1xuICBsYWJlbDogc3RyaW5nO1xuICB2YWx1ZTogc3RyaW5nO1xufSkgPT4ge1xuICBjb25zdCBbaXNFeHBhbmRlZCwgc2V0SXNFeHBhbmRlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IGxpbmVzID0gdmFsdWUuc3BsaXQoJ1xcbicpO1xuICBjb25zdCBzaG93TW9yZSA9IGxpbmVzLmxlbmd0aCA+IDI7XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT1cImxvZy1kZXRhaWwtcm93XCI+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImxvZy1kZXRhaWwtbGFiZWxcIj57bGFiZWx9PC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImxvZy1kZXRhaWwtdmFsdWVcIj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjb2xsYXBzaWJsZS1jb250ZW50XCI+XG4gICAgICAgICAge2lzRXhwYW5kZWQgPyAoXG4gICAgICAgICAgICBsaW5lcy5tYXAoKGxpbmUsIGkpID0+IDxkaXYga2V5PXtpfT57bGluZX08L2Rpdj4pXG4gICAgICAgICAgKSA6IChcbiAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgIHtsaW5lcy5zbGljZSgwLCAyKS5tYXAoKGxpbmUsIGkpID0+IChcbiAgICAgICAgICAgICAgICA8ZGl2IGtleT17aX0+e2xpbmV9PC9kaXY+XG4gICAgICAgICAgICAgICkpfVxuICAgICAgICAgICAgICB7c2hvd01vcmUgJiYgPGRpdj4uLi48L2Rpdj59XG4gICAgICAgICAgICA8Lz5cbiAgICAgICAgICApfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAge3Nob3dNb3JlICYmIChcbiAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICBjbGFzc05hbWU9XCJjb2xsYXBzaWJsZS10b2dnbGUtYnV0dG9uXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNldElzRXhwYW5kZWQoIWlzRXhwYW5kZWQpfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtpc0V4cGFuZGVkID8gJ+KWvCcgOiAn4pa2J30ge2lzRXhwYW5kZWQgPyAnU2hvdyBMZXNzJyA6ICdTaG93IE1vcmUnfVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG5jb25zdCBKc29uRmllbGQgPSAoeyB2YWx1ZSB9OiB7IHZhbHVlOiBzdHJpbmcgfSkgPT4ge1xuICBjb25zdCBbaXNFeHBhbmRlZCwgc2V0SXNFeHBhbmRlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGxldCBwYXJzZWRWYWx1ZTtcblxuICB0cnkge1xuICAgIC8vIEZpcnN0IHBhcnNlIHRvIGhhbmRsZSBhbnkgZXNjYXBlIGNoYXJhY3RlcnNcbiAgICBjb25zdCB1bmVzY2FwZWRWYWx1ZSA9IEpTT04ucGFyc2UodmFsdWUpO1xuICAgIC8vIFRoZW4gc3RyaW5naWZ5IGFuZCBwYXJzZSBhZ2FpbiB0byBnZXQgY2xlYW4gSlNPTlxuICAgIHBhcnNlZFZhbHVlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh1bmVzY2FwZWRWYWx1ZSwgbnVsbCwgMikpO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJsb2ctZGV0YWlsLXZhbHVlXCI+e3ZhbHVlfTwvZGl2PjtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9XCJqc29uLWZpZWxkXCI+XG4gICAgICA8YnV0dG9uXG4gICAgICAgIGNsYXNzTmFtZT1cImpzb24tdG9nZ2xlLWJ1dHRvblwiXG4gICAgICAgIG9uQ2xpY2s9eygpID0+IHNldElzRXhwYW5kZWQoIWlzRXhwYW5kZWQpfVxuICAgICAgPlxuICAgICAgICB7aXNFeHBhbmRlZCA/ICfilrwnIDogJ+KWtid9IHsneyAuLi4gfSd9XG4gICAgICA8L2J1dHRvbj5cbiAgICAgIHtpc0V4cGFuZGVkICYmIChcbiAgICAgICAgPHByZSBjbGFzc05hbWU9XCJqc29uLWNvbnRlbnRcIj5cbiAgICAgICAgICB7SlNPTi5zdHJpbmdpZnkocGFyc2VkVmFsdWUsIG51bGwsIDIpfVxuICAgICAgICA8L3ByZT5cbiAgICAgICl9XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG5jb25zdCBNb2RlbFJvdXRpbmdIaXN0b3J5ID0gKHsgaGlzdG9yeSB9OiB7IGhpc3Rvcnk6IGFueSB9KSA9PiB7XG4gIGlmICghaGlzdG9yeSkgcmV0dXJuIG51bGw7XG5cbiAgdHJ5IHtcbiAgICBsZXQgZXZlbnRzO1xuICAgIGlmIChBcnJheS5pc0FycmF5KGhpc3RvcnkpKSB7XG4gICAgICBldmVudHMgPSBoaXN0b3J5O1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGhpc3RvcnkgPT09ICdzdHJpbmcnKSB7XG4gICAgICB0cnkge1xuICAgICAgICBldmVudHMgPSBKU09OLnBhcnNlKGhpc3RvcnkpO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIC8vIElmIGl0J3MgYSBzdHJpbmcgYnV0IG5vdCBKU09OLCB0cnkgdG8gcGFyc2UgaXQgYXMgYSBjb21tYS1zZXBhcmF0ZWQgbGlzdFxuICAgICAgICBldmVudHMgPSBoaXN0b3J5LnNwbGl0KCfihpInKS5tYXAoKGl0ZW06IHN0cmluZykgPT4ge1xuICAgICAgICAgIGNvbnN0IFtwcm92aWRlciwgbW9kZWxdID0gaXRlbS50cmltKCkuc3BsaXQoJzonKTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ3JvdXRlZF90b19zcGVjaWZpZWQnLFxuICAgICAgICAgICAgcHJvdmlkZXI6IHByb3ZpZGVyPy50cmltKCksXG4gICAgICAgICAgICBtb2RlbDogbW9kZWw/LnRyaW0oKSxcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZXZlbnRzID0gW2hpc3RvcnldO1xuICAgIH1cblxuICAgIGlmICghQXJyYXkuaXNBcnJheShldmVudHMpKSB7XG4gICAgICBldmVudHMgPSBbZXZlbnRzXTtcbiAgICB9XG5cbiAgICAvLyBGaWx0ZXIgb3V0IGFueSBpbnZhbGlkIGV2ZW50c1xuICAgIGV2ZW50cyA9IGV2ZW50c1xuICAgICAgLm1hcCgoZSkgPT4gSlNPTi5wYXJzZShlKSlcbiAgICAgIC5maWx0ZXIoKGV2ZW50KSA9PiBldmVudCAmJiAoZXZlbnQudHlwZSB8fCBldmVudC5wcm92aWRlcikpO1xuXG4gICAgaWYgKGV2ZW50cy5sZW5ndGggPT09IDApIHJldHVybiBudWxsO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwibG9nLWRldGFpbC1yb3dcIj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsb2ctZGV0YWlsLWxhYmVsXCI+TW9kZWwgUm91dGluZyBIaXN0b3J5PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibG9nLWRldGFpbC12YWx1ZVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicm91dGluZy1oaXN0b3J5XCI+XG4gICAgICAgICAgICB7ZXZlbnRzLm1hcCgoZXZlbnQsIGluZGV4KSA9PiAoXG4gICAgICAgICAgICAgIDxkaXYga2V5PXtpbmRleH0gY2xhc3NOYW1lPVwicm91dGluZy1ldmVudFwiPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImV2ZW50LXR5cGVcIj57ZXZlbnQudHlwZSB8fCAncm91dGVkJ308L3NwYW4+XG4gICAgICAgICAgICAgICAge2V2ZW50LnByb3ZpZGVyICYmIChcbiAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImV2ZW50LWRldGFpbFwiPlxuICAgICAgICAgICAgICAgICAgICB7ZXZlbnQucHJvdmlkZXJ9OntldmVudC5tb2RlbCB8fCAnZGVmYXVsdCd9XG4gICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICB7aW5kZXggPCBldmVudHMubGVuZ3RoIC0gMSAmJiAoXG4gICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJldmVudC1hcnJvd1wiPuKGkjwvc3Bhbj5cbiAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICkpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyBtb2RlbCByb3V0aW5nIGhpc3Rvcnk6JywgZXJyb3IsIGhpc3RvcnkpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG5jb25zdCBMb2dEZXRhaWwgPSAoeyBsb2cgfTogTG9nRGV0YWlsUHJvcHMpID0+IHtcbiAgY29uc3QgZ2V0UHJvbXB0ID0gKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXF1ZXN0ID0gSlNPTi5wYXJzZShsb2cucmF3X3JlcXVlc3QgfHwgJ3t9Jyk7XG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXF1ZXN0LmJvZHkgfHwgJ3t9Jyk7XG4gICAgICByZXR1cm4gYm9keS5wcm9tcHQ7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2V0UmVzcG9uc2UgPSAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gSlNPTi5wYXJzZShsb2cucmF3X3Jlc3BvbnNlIHx8ICd7fScpO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnRleHQ7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZm9ybWF0VmFsdWUgPSAoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpID0+IHtcbiAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gJycpIHJldHVybiBudWxsO1xuXG4gICAgaWYgKGtleSA9PT0gJ3RpbWVzdGFtcCcgJiYgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIG5ldyBEYXRlKHZhbHVlKS50b0xvY2FsZVN0cmluZyh1bmRlZmluZWQsIHtcbiAgICAgICAgeWVhcjogJ251bWVyaWMnLFxuICAgICAgICBtb250aDogJzItZGlnaXQnLFxuICAgICAgICBkYXk6ICcyLWRpZ2l0JyxcbiAgICAgICAgaG91cjogJzItZGlnaXQnLFxuICAgICAgICBtaW51dGU6ICcyLWRpZ2l0JyxcbiAgICAgICAgc2Vjb25kOiAnMi1kaWdpdCcsXG4gICAgICAgIGhvdXIxMjogZmFsc2UsXG4gICAgICAgIHRpbWVab25lTmFtZTogJ3Nob3J0JyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChrZXkgPT09ICdyYXdfcmVxdWVzdCcgfHwga2V5ID09PSAncmF3X3Jlc3BvbnNlJyB8fCBrZXkgPT09ICdtZXRhZGF0YScpIHtcbiAgICAgIHJldHVybiA8SnNvbkZpZWxkIHZhbHVlPXt2YWx1ZX0gLz47XG4gICAgfVxuXG4gICAgaWYgKGtleSA9PT0gJ2lzX3N1Y2Nlc3NmdWwnKSB7XG4gICAgICByZXR1cm4gdmFsdWUgPyAnc3VjY2VzcycgOiAnZmFpbHVyZSc7XG4gICAgfVxuXG4gICAgcmV0dXJuIFN0cmluZyh2YWx1ZSk7XG4gIH07XG5cbiAgY29uc3QgbG9nRmllbGRzID0gW1xuICAgIHsga2V5OiAndGltZXN0YW1wJywgbGFiZWw6ICdUaW1lc3RhbXAnIH0sXG4gICAgeyBrZXk6ICdsYXRlbmN5JywgbGFiZWw6ICdMYXRlbmN5IChtcyknIH0sXG4gICAgeyBrZXk6ICdpc19zdWNjZXNzZnVsJywgbGFiZWw6ICdTdGF0dXMnIH0sXG4gICAgeyBrZXk6ICdzdWNjZXNzX3JlYXNvbicsIGxhYmVsOiAnU3VjY2VzcyBSZWFzb24nIH0sXG4gICAgeyBrZXk6ICdlcnJvcl9yZWFzb24nLCBsYWJlbDogJ0Vycm9yIFJlYXNvbicgfSxcbiAgICB7IGtleTogJ3VzZXJfaWQnLCBsYWJlbDogJ1VzZXIgSUQnIH0sXG4gICAgeyBrZXk6ICd0aHJlYWRfaWQnLCBsYWJlbDogJ1RocmVhZCBJRCcgfSxcbiAgICB7IGtleTogJ3Byb3ZpZGVyJywgbGFiZWw6ICdQcm92aWRlcicgfSxcbiAgICB7IGtleTogJ21vZGVsJywgbGFiZWw6ICdNb2RlbCcgfSxcbiAgICB7IGtleTogJ2Nvc3QnLCBsYWJlbDogJ0Nvc3QnIH0sXG4gICAgeyBrZXk6ICdtZXRhZGF0YScsIGxhYmVsOiAnTWV0YWRhdGEnIH0sXG4gICAgeyBrZXk6ICdyYXdfcmVxdWVzdCcsIGxhYmVsOiAnUmF3IFJlcXVlc3QnIH0sXG4gICAgeyBrZXk6ICdyYXdfcmVzcG9uc2UnLCBsYWJlbDogJ1JhdyBSZXNwb25zZScgfSxcbiAgICB7IGtleTogJ2Vycm9yX21lc3NhZ2UnLCBsYWJlbDogJ0Vycm9yIE1lc3NhZ2UnIH0sXG4gIF07XG5cbiAgY29uc3QgcHJvbXB0ID0gZ2V0UHJvbXB0KCk7XG4gIGNvbnN0IHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoKTtcblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPVwibG9nLWRldGFpbC1jb250YWluZXJcIj5cbiAgICAgIDxoMj5Mb2cgRGV0YWlsczwvaDI+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImxvZy1kZXRhaWwtY29udGVudFwiPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxvZy1kZXRhaWwtcm93XCI+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsb2ctZGV0YWlsLWxhYmVsXCI+SUQ8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxvZy1kZXRhaWwtdmFsdWVcIj57bG9nLmlkIHx8ICdOL0EnfTwvZGl2PlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICB7cHJvbXB0ICYmIDxDb2xsYXBzaWJsZUZpZWxkIGxhYmVsPVwiUHJvbXB0XCIgdmFsdWU9e3Byb21wdH0gLz59XG4gICAgICAgIHtyZXNwb25zZSAmJiA8Q29sbGFwc2libGVGaWVsZCBsYWJlbD1cIlJlc3BvbnNlXCIgdmFsdWU9e3Jlc3BvbnNlfSAvPn1cbiAgICAgICAge2xvZy5tb2RlbF9yb3V0aW5nX2hpc3RvcnkgJiYgKFxuICAgICAgICAgIDxNb2RlbFJvdXRpbmdIaXN0b3J5IGhpc3Rvcnk9e2xvZy5tb2RlbF9yb3V0aW5nX2hpc3Rvcnl9IC8+XG4gICAgICAgICl9XG5cbiAgICAgICAge2xvZ0ZpZWxkcy5tYXAoKHsga2V5LCBsYWJlbCB9KSA9PiB7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBmb3JtYXRWYWx1ZShrZXksIGxvZ1trZXkgYXMga2V5b2YgTG9nRW50cnldKTtcbiAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHJldHVybiBudWxsO1xuXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYga2V5PXtrZXl9IGNsYXNzTmFtZT1cImxvZy1kZXRhaWwtcm93XCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibG9nLWRldGFpbC1sYWJlbFwiPntsYWJlbH08L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsb2ctZGV0YWlsLXZhbHVlXCI+e3ZhbHVlfTwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgKTtcbiAgICAgICAgfSl9XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IExvZ0RldGFpbDtcbiJdfQ==